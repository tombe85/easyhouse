<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="/sweethomesw/jquery/jquery.mobile.structure-1.4.5.css" />
        <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
        <script type="text/javascript" src="/sweethomesw/jquery/jquery.mobile-1.4.5.js"></script>
        <link rel="stylesheet" style="text/css" href="/sweethomesw/css/rejilla.css" />
        <link rel="stylesheet" style="text/css" href="/sweethomesw/css/interfaz.css" />
        <script>
            function getCookie(galleta) {
                var name = galleta + "=";
                var arr = document.cookie.split(';');
                for(var i=0; i<arr.length; i++) {
                    var cook = arr[i];
                    while (cook.charAt(0)==' ') 
                        cook = cook.substring(1);
                    if (cook.indexOf(name) == 0) 
                        return cook.substring(name.length, cook.length);
                }
                return "";
            }
            $(document).bind('pagebeforecreate',function(){
                var loged = getCookie("login");
                if(loged == true){
                    location.href='/sweethomesw/home.html';
                }
            });
            $(document).bind('pageinit', function(){
                $("#headerlogin").load("/sweethomesw/ajax/header.php");
                $(document).ajaxComplete(function(){
                    $("#backbutton").css("display","none");
                    $("#fotousuario").css("display","none");
                });
            });
            
            function validaCampos(formu){
                if(formu.usuario.value == "" || formu.email.value == "" || formu.passwd.value == "" || formu.passwd2.value == ""){
                    alert("Debes rellenar todos los campos");
                    return false;
                }else{
                    if(formu.passwd.value !== formu.passwd2.value){
                        alert("Las contraseñas no coinciden");
                        return false;
                    }else{
                        jQuery.post('/sweethomesw/backend/userreg/consultamailregistro.php', {mail:formu.email.value}, function(data, textStatus){
                            if(data == 1){
                                alert("El mail introducido ya existe");
                                return false;
                            }else if(data == 0){
                                return true;
                            }else if(data == 2 || data == 3){
                                alert("A ocurrido un error. Por favor accede desde el enlace enviado a tu correo");
                                return false;
                            }else{
                                alert("A ocurrido un error");
                                return false;
                            }
                        });
                    }
                }
            }
            
            //Hacer lo de la fotousuario
            function changeImage(fileimput){
                $("#imageButton").find("img").attr("src", "/sweethomesw/img/ok.png");
            }
        </script>
    </head>
    <body>
        <header id="headerlogin" data-role="header" data-position="fixed" data-tap-toggle="false"></header>
        <div id="contentInput" data-role="content">
            <form method="post" action="/sweethomesw/backend/userreg/registrousuario.php" onsubmit="return validaCampos(this)" data-ajax="false" enctype="multipart/form-data">
                <div class="dataInput">
                    <h4>Usuario</h4>
                    <input type="text" name="usuario">
                </div>
                <div class="dataInput">
                    <h4>Email</h4>
                    <input type="email" name="email">
                </div>
                <div class="dataInput">
                    <h4>Contraseña</h4>
                    <input type="password" name="passwd">
                </div>
                <div class="dataInput">
                    <h4>Repita contraseña</h4>
                    <input type="password" name="passwd2">
                </div>
                <div class="submitbutton">
                    <button id="registerbutton" type="submit"><h4>Registrarse</h4></button>
                </div>
            </form>
        </div>
    </body>
</html>
